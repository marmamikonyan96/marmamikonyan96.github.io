"use strict";var _require=require("gulp"),src=_require.src,dest=_require.dest,parallel=_require.parallel,series=_require.series,watch=_require.watch,autoprefixer=require("gulp-autoprefixer"),cleanCSS=require("gulp-clean-css"),uglify=require("gulp-uglify-es").default,del=require("del"),browserSync=require("browser-sync").create(),sass=require("gulp-sass"),rename=require("gulp-rename"),fileinclude=require("gulp-file-include"),gutil=require("gulp-util"),ftp=require("vinyl-ftp"),sourcemaps=require("gulp-sourcemaps"),notify=require("gulp-notify"),svgSprite=require("gulp-svg-sprite"),ttf2woff2=require("gulp-ttf2woff2"),fs=require("fs"),tiny=require("gulp-tinypng-compress"),rev=require("gulp-rev"),revRewrite=require("gulp-rev-rewrite"),revdel=require("gulp-rev-delete-original"),htmlmin=require("gulp-htmlmin"),svgSprites=function(){return src("./src/img/svg/**.svg").pipe(svgSprite({mode:{stack:{sprite:"../sprite.svg"}}})).pipe(dest("./app/img"))},resources=function(){return src("./src/resources/**").pipe(dest("./app"))},imgToApp=function(){return src(["./src/img/**.jpg","./src/img/**.png","./src/img/**.jpeg","./src/img/*.svg"]).pipe(dest("./app/img"))},htmlInclude=function(){return src(["./src/*.html"]).pipe(fileinclude({prefix:"@",basepath:"@file"})).pipe(dest("./app")).pipe(browserSync.stream())},fonts=function(){return src("./src/fonts/**.ttf").pipe(ttf2woff2()).pipe(dest("./app/fonts/"))},checkWeight=function(e){var r=400;switch(!0){case/Regular/.test(e):r=400;break;case/Medium/.test(e):r=500;break;case/Semi/.test(e):r=600;break;case/Bold/.test(e):r=700}return r},cb=function(){},srcFonts="./src/scss/_fonts.scss",appFonts="./app/fonts/",fontsStyle=function(e){fs.readFileSync(srcFonts);fs.writeFile(srcFonts,"",cb),fs.readdir(appFonts,function(e,r){if(r)for(var s,p=0;p<r.length;p++){var t=r[p].split("."),i=(t=t[0]).split("-")[0],n=checkWeight(t);s!=t&&fs.appendFile(srcFonts,'@include font-face("'+i+'", "'+t+'", '+n+");\r\n",cb),s=t}}),e()},styles=function(){return src("./src/scss/**/*.scss").pipe(sourcemaps.init()).pipe(sass({outputStyle:"expanded"}).on("error",notify.onError())).pipe(rename({suffix:".min"})).pipe(autoprefixer({cascade:!1})).pipe(cleanCSS({level:2})).pipe(sourcemaps.write(".")).pipe(dest("./app/css/")).pipe(browserSync.stream())},scripts=function(){return src("./src/js/main.js").pipe(webpackStream({mode:"development",output:{filename:"main.js"},module:{rules:[{test:/\.m?js$/,exclude:/(node_modules|bower_components)/,use:{loader:"babel-loader",options:{presets:["@babel/preset-env"]}}}]}})).on("error",function(e){console.error("WEBPACK ERROR",e),this.emit("end")}).pipe(sourcemaps.init()).pipe(uglify().on("error",notify.onError())).pipe(sourcemaps.write(".")).pipe(dest("./app/js")).pipe(browserSync.stream())},watchFiles=function(){browserSync.init({server:{baseDir:"./app"}}),watch("./src/scss/**/*.scss",styles),watch("./src/js/**/*.js",scripts),watch("./src/html/*.html",htmlInclude),watch("./src/*.html",htmlInclude),watch("./src/resources/**",resources),watch("./src/img/**.jpg",imgToApp),watch("./src/img/**.jpeg",imgToApp),watch("./src/img/**.png",imgToApp),watch("./src/img/svg/**.svg",svgSprites),watch("./src/fonts/**",fonts),watch("./src/fonts/**",fontsStyle)},clean=function(){return del(["app/*"])};exports.fileinclude=htmlInclude,exports.styles=styles,exports.scripts=scripts,exports.watchFiles=watchFiles,exports.fonts=fonts,exports.default=series(clean,parallel(htmlInclude,scripts,fonts,resources,imgToApp,svgSprites),styles,watchFiles);var tinypng=function(){return src(["./src/img/**.jpg","./src/img/**.png","./src/img/**.jpeg"]).pipe(tiny({key:"HkdjDW01hVL5Db6HXSYlnHMk9HCvQfDT",sigFile:"./app/img/.tinypng-sigs",parallel:!0,parallelMax:50,log:!0})).pipe(dest("./app/img"))},stylesBuild=function(){return src("./src/scss/**/*.scss").pipe(sass({outputStyle:"expanded"}).on("error",notify.onError())).pipe(rename({suffix:".min"})).pipe(autoprefixer({cascade:!1})).pipe(cleanCSS({level:2})).pipe(dest("./app/css/"))},scriptsBuild=function(){return src("./src/js/main.js").pipe(webpackStream({mode:"development",output:{filename:"main.js"},module:{rules:[{test:/\.m?js$/,exclude:/(node_modules|bower_components)/,use:{loader:"babel-loader",options:{presets:["@babel/preset-env"]}}}]}})).on("error",function(e){console.error("WEBPACK ERROR",e),this.emit("end")}).pipe(uglify().on("error",notify.onError())).pipe(dest("./app/js"))},cache=function(){return src("app/**/*.{css,js,svg,png,jpg,jpeg,woff2}",{base:"app"}).pipe(rev()).pipe(revdel()).pipe(dest("app")).pipe(rev.manifest("rev.json")).pipe(dest("app"))},rewrite=function(){var e=src("app/rev.json");return src("app/**/*.html").pipe(revRewrite({manifest:e})).pipe(dest("app"))},htmlMinify=function(){return src("app/**/*.html").pipe(htmlmin({collapseWhitespace:!0})).pipe(dest("app"))};exports.cache=series(cache,rewrite),exports.build=series(clean,parallel(htmlInclude,scriptsBuild,fonts,resources,imgToApp,svgSprites),stylesBuild,htmlMinify,tinypng);var deploy=function(){var e=ftp.create({host:"",user:"",password:"",parallel:10,log:gutil.log});return src(["app/**"],{base:"./app",buffer:!1}).pipe(e.newer("")).pipe(e.dest(""))};exports.deploy=deploy;